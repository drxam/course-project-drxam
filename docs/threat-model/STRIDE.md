# STRIDE Threat Analysis

## –û–±–∑–æ—Ä
–ê–Ω–∞–ª–∏–∑ —É–≥—Ä–æ–∑ –ø–æ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ STRIDE –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏–∑ DFD.

## STRIDE Categories
- **S**poofing - –ü–æ–¥–º–µ–Ω–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **T**ampering - –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **R**epudiation - –û—Ç–∫–∞–∑ –æ—Ç –¥–µ–π—Å—Ç–≤–∏–π
- **I**nformation Disclosure - –†–∞—Å–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- **D**enial of Service - –û—Ç–∫–∞–∑ –≤ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏
- **E**levation of Privilege - –ü–æ–≤—ã—à–µ–Ω–∏–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

## Threat Analysis Table

| Flow ID | –≠–ª–µ–º–µ–Ω—Ç/–ü–æ—Ç–æ–∫ | STRIDE | –£–≥—Ä–æ–∑–∞ | –ö–æ–Ω—Ç—Ä–æ–ª—å | NFR | –ü—Ä–æ–≤–µ—Ä–∫–∞ |
|---------|---------------|--------|--------|----------|-----|----------|
| F1 | POST /items | T | Injection –∞—Ç–∞–∫–∞ —á–µ—Ä–µ–∑ name | Input validation, sanitization | NFR-004 | Unit tests (test_errors.py) |
| F1 | POST /items | D | DoS —á–µ—Ä–µ–∑ –º–∞—Å—Å–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã | Rate limiting 100 req/min | NFR-008 | Load testing |
| F2 | GET /items/{id} | I | –£—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ item_id | Authorization check | NFR-006 | Auth tests |
| F2 | GET /items/{id} | D | DoS —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–±–æ—Ä ID | Rate limiting, caching | NFR-008 | Load testing |
| F4 | Input Validator | T | –û–±—Ö–æ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ | 100% coverage validation | NFR-004 | Unit tests |
| F8 | Store Item | T | SQL Injection | Parameterized queries, ORM | NFR-004 | SAST scan |
| F8 | Store Item | I | –ß—Ç–µ–Ω–∏–µ —á—É–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö | Access control, DB permissions | NFR-005 | Integration tests |
| F9 | Query Item | I | Information disclosure | Minimal data exposure | NFR-003 | Code review |
| F10 | Log Events | R | –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤ | Immutable logs, log rotation | NFR-007 | Log integrity check |
| F11 | Log Validation Errors | I | –£—Ç–µ—á–∫–∞ —á–µ—Ä–µ–∑ –ª–æ–≥–∏ | Sanitize sensitive data in logs | NFR-007 | Log review |

## –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —É–≥—Ä–æ–∑

### F1: POST /items

#### –£–≥—Ä–æ–∑–∞ 1: Tampering - Injection –∞—Ç–∞–∫–∞
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –≤–Ω–µ–¥—Ä–∏—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –∫–æ–¥ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `name`

**–°—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏:**
```bashPOST /items?name=<script>alert('xss')</script>
POST /items?name=' OR '1'='1

**–ö–æ–Ω—Ç—Ä–æ–ª–∏:**
- Input validation (NFR-004): 100% –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- Sanitization: –û—á–∏—Å—Ç–∫–∞ HTML/SQL —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
- Length check: name ‚â§ 100 —Å–∏–º–≤–æ–ª–æ–≤

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- Unit —Ç–µ—Å—Ç—ã: `test_create_item_validation()` –≤ `tests/test_errors.py`
- SAST: Ruff –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

---

#### –£–≥—Ä–æ–∑–∞ 2: Denial of Service - –ú–∞—Å—Å–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å API –º–∞—Å—Å–æ–≤—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ —Å–æ–∑–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤

**–°—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏:**
```pythonfor i in range(10000):
requests.post("/items", params={"name": f"item_{i}"})

**–ö–æ–Ω—Ç—Ä–æ–ª–∏:**
- Rate limiting (NFR-008): 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ IP
- Request timeout: 30 —Å–µ–∫—É–Ω–¥
- Connection limits: max 100 concurrent connections

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- Load testing: k6 –∏–ª–∏ JMeter —Å—Ü–µ–Ω–∞—Ä–∏–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: Alerts –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞

**–°—Ç–∞—Ç—É—Å:** üî∂ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –≤ v1.1

---

### F2: GET /items/{id}

#### –£–≥—Ä–æ–∑–∞ 1: Information Disclosure - –£—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–±–æ—Ä ID

**–°—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏:**
```bashGET /items/1  # –ß—É–∂–æ–π —ç–ª–µ–º–µ–Ω—Ç
GET /items/2
GET /items/3
...

**–ö–æ–Ω—Ç—Ä–æ–ª–∏:**
- Authorization check (NFR-006): –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞
- Token validation: JWT —Å TTL ‚â§ 1 —á–∞—Å
- Audit logging: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–æ–≤

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- Integration tests: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ —Ç–æ–ª—å–∫–æ –∫ —Å–≤–æ–∏–º —ç–ª–µ–º–µ–Ω—Ç–∞–º
- Security tests: –ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —á—É–∂–∏–º –¥–∞–Ω–Ω—ã–º

**–°—Ç–∞—Ç—É—Å:** üî∂ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –≤ v1.1

---

### F4: Input Validator

#### –£–≥—Ä–æ–∑–∞: Tampering - –û–±—Ö–æ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –æ–±–æ–π—Ç–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏–ª–∏ encoding

**–°—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏:**
```bashPOST /items?name=%00  # Null byte
POST /items?name=%E2%80%8B  # Zero-width space
POST /items?name=\u0000

**–ö–æ–Ω—Ç—Ä–æ–ª–∏:**
- Comprehensive validation (NFR-004): –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏, whitespace
- Character whitelist: –¢–æ–ª—å–∫–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã
- Length normalization: Trim + length check

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- Unit tests: `test_nfr_004_input_validation_*()` –≤ `tests/test_nfr.py`
- Fuzzing: –°–ª—É—á–∞–π–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

---

### F8-F9: Database Operations

#### –£–≥—Ä–æ–∑–∞ 1: Tampering - SQL Injection
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–°—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏:**
```pythonname = "'; DROP TABLE items; --"

**–ö–æ–Ω—Ç—Ä–æ–ª–∏:**
- ORM usage: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ORM –≤–º–µ—Å—Ç–æ raw SQL
- Parameterized queries: –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ bind variables
- Input validation: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- SAST: Bandit/Semgrep –ø—Ä–æ–≤–µ—Ä—è—é—Ç SQL injection patterns
- Code review: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö DB –∑–∞–ø—Ä–æ—Å–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (in-memory DB)

---

#### –£–≥—Ä–æ–∑–∞ 2: Information Disclosure - –£—Ç–µ—á–∫–∞ —á–µ—Ä–µ–∑ DB
**–û–ø–∏—Å–∞–Ω–∏–µ:** –û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –º–æ–≥—É—Ç —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö

**–°—Ü–µ–Ω–∞—Ä–∏–π:**Database error: Table 'items' doesn't exist
SQL: SELECT * FROM items WHERE id = 999

**–ö–æ–Ω—Ç—Ä–æ–ª–∏:**
- Error handling (NFR-003): –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- Minimal exposure: –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º SQL –≤ –æ—Ç–≤–µ—Ç–∞—Ö
- Structured logging: –î–µ—Ç–∞–ª–∏ —Ç–æ–ª—å–∫–æ –≤ –ª–æ–≥–∞—Ö

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- Integration tests: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –æ—à–∏–±–æ–∫
- Code review: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ raw SQL –≤ –æ—Ç–≤–µ—Ç–∞—Ö

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

---

### F10-F11: Logging

#### –£–≥—Ä–æ–∑–∞ 1: Repudiation - –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è —É–¥–∞–ª–∏—Ç—å —Å–ª–µ–¥—ã —Å–≤–æ–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π

**–ö–æ–Ω—Ç—Ä–æ–ª–∏:**
- Immutable logs (NFR-007): –õ–æ–≥–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ append
- Log rotation: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏–≤–∞—Ü–∏—è
- Remote logging: –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- Log integrity tests: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–¥–∞–ª–µ–Ω–∏—è
- Monitoring: –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–æ–ø–∞–∂–µ –ª–æ–≥–æ–≤

**–°—Ç–∞—Ç—É—Å:** üî∂ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –≤ v1.1

---

#### –£–≥—Ä–æ–∑–∞ 2: Information Disclosure - –£—Ç–µ—á–∫–∞ —á–µ—Ä–µ–∑ –ª–æ–≥–∏
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –ø–æ–ø–∞—Å—Ç—å –≤ –ª–æ–≥–∏

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
```pythonlogger.info(f"User password: {password}")  # ‚ùå BAD
logger.info(f"User token: {jwt_token}")    # ‚ùå BAD

**–ö–æ–Ω—Ç—Ä–æ–ª–∏:**
- Log sanitization: –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- Structured logging: –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è
- Log review: –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- Code review: –ü–æ–∏—Å–∫ password/token –≤ –ª–æ–≥–∞—Ö
- Log analysis: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ patterns

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

---

## –°–≤–æ–¥–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º STRIDE

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≥—Ä–æ–∑ | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |
|-----------|------------------|-------------|-------------|
| Spoofing (S) | 0 | 0 | 0 |
| Tampering (T) | 3 | 2 | 1 |
| Repudiation (R) | 1 | 0 | 1 |
| Information Disclosure (I) | 4 | 2 | 2 |
| Denial of Service (D) | 2 | 0 | 2 |
| Elevation of Privilege (E) | 0 | 0 | 0 |
| **–ò–¢–û–ì–û** | **10** | **4** | **6** |

## –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è —É–≥—Ä–æ–∑

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (v1.0)
- ‚úÖ T: Injection –∞—Ç–∞–∫–∞ (F1, F4, F8)
- ‚úÖ I: –£—Ç–µ—á–∫–∞ —á–µ—Ä–µ–∑ –ª–æ–≥–∏ (F11)

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (v1.1)
- üî∂ D: DoS –∞—Ç–∞–∫–∏ (F1, F2)
- üî∂ I: Unauthorized access (F2, F8)

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (v1.2+)
- üî∂ R: Log tampering (F10)

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- [DFD.md](./DFD.md) - Data Flow Diagram
- [RISKS.md](./RISKS.md) - Risk Register
- [../security-nfr/NFR.md](../security-nfr/NFR.md) - Non-Functional Requirements
